<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
	<title>CAR GAME</title>
	<style type="text/css">
	#sence{border:1px solid #ccc;position:relative;}
	.mainbox{
		width:100%;
		margin:0 auto;
		height: 100%;
	}
	#block{width:50px;height:50px;background:#f00;position:fixed;left:0;top:0;}

	@-webkit-keyframes reverseRotataZ{
    0%{-webkit-transform: rotateZ(0deg);}
    100%{-webkit-transform: rotateZ(-360deg);}
    }
    @-webkit-keyframes rotataZ{
    0%{-webkit-transform: rotateZ(0deg);}
    100%{-webkit-transform: rotateZ(360deg);}
    }
    #musicControl { position:fixed;right:450px;top:40px;margin-top:0;display:inline-block;z-index:99999999}
    #musicControl a { display:inline-block;width: 25px; height: 25px;overflow:hidden;background:url('./images/mcbg.png') no-repeat;background-size:100%;}
    #musicControl a audio{width:100%;height:56px;}
    #musicControl a.stop { background-position:left bottom;}
    #musicControl a.on { background-position:0px 1px;-webkit-animation: reverseRotataZ 1.2s linear infinite;}
	</style>
	<style media="screen">
	.mask {
z-index: 9998;
position:fixed;
top:0;
left:0;
width:100%;
height:100%;
background:#000;
opacity:0.4;
filter:alpha(opacity=40);
display:none
}
.onmask {
z-index:9999;
position:fixed;
top:30%;
left:40%;
width:200px;
height:120px;
margin:0 auto;
border-radius:5px;
border:solid 2px #666;
background-color:#fff;
display:none;
box-shadow: 0 0 10px #666;
}
	</style>
	<style type="text/css">
	/*Stylesheet*/
BODY, HTML
{
		-webkit-tap-highlight-color: rgba(0,0,0,0);
		-webkit-touch-callout: none;
		-webkit-text-size-adjust: none;
		-webkit-user-select: none;
	margin: 			0;
	padding: 			0;
	font-family: 		Arial, Verdana, sans-serif;
	font-size: 			12px;
	font-weight:		normal;
	color: 				#ccc;
	background-color:	white;
	overflow-x:hidden;
  overflow-y:hidden;
}

#sence {
	width: 100%;
	height: 100%;
	/*position: absolute;*/
	text-align:center;
	margin: 0 auto;
		display: block !important;
}
	</style>
</head>

<body>
	<div class="mask" id="mask">

	</div>
	<div class="onmask" id="safe">
		<h3>开车时一定要系安全带</h3>
	</div>
	<div class="onmask" id="phone">
		<h3>老板来电话了！</h3>
		<h4><a id="jie">接</a><a id="bujie" style="margin-left:100px">不接</a></h4>
		<h4><a id="text"></a></h4>
	</div>
<div class="mainbox">

	<canvas id="sence" width="640" height="480"></canvas>
</div>
<span id="musicControl" style="display:none">
    <a id="mc_play" class="stop on" onclick="play_music();">
        <audio id="bgmusic" loop="loop" autoplay="autoplay">
            <source src="http://resources-user-audio.vxue360.com/778f8723e176c828c280f7c9b7eb6e00.mp3" type="audio/mpeg">
        </audio>
    </a>
    <a id="coin_play" style="display:none">
        <audio id="coinmusic" loop="loop">
            <source src="http://resources-user-audio.vxue360.com/778f8723e176c828c280f7c9b7eb6e00.mp3" type="audio/mpeg">
        </audio>
    </a>
</span>
<script src="webview.js" charset="utf-8"></script>
<script src="lib/util.js"></script>
<script src="lib/entities.js"></script>
<script src="user-entities.js"></script>
<script src="lib/patch-enhancement.js"></script>
<script src="lib/main_app.js"></script>
<script src="lib/jquery.js"></script>
<script type="text/javascript">
var runWithOther=true;
var screenObjects = [];
var startTime = null;

var resources = [
	{'name': 'car1', src: 'images/car1.png', type: 'images'},
	{'name': 'car2', src: 'images/car2.png', type: 'images'},
	{'name': 'car3', src: 'images/car3.png', type: 'images'},
	{'name': 'car4', src: 'images/car4.png', type: 'images'},
	{'name': 'car5', src: 'images/car5.png', type: 'images'},
	{'name': 'car_p', src: 'images/car_p.png', type: 'images'},
	{'name': 'saint', src: 'images/saint.png', type: 'images'},
	{'name': 'soldier', src: 'images/soldier.png', type: 'images'},
	{'name': 'tree', src: 'images/tree.png', type: 'images'},
	{'name': 'road', src: 'images/road.png', type: 'images'},
	{'name': 'coin', src: 'images/coin.jpg', type: 'images'},
	{'name': 'bike', src: 'images/bike.png', type: 'images'},
	{'name': 'ask' , src: 'images/ask.jpeg', type: 'images'},
	{'name': 'road1',src: 'images/road1.png',type: 'images'},
	{'name': 'back' ,src: 'images/back.jpg' ,type: 'images'},
	{'name': 'schoolBus', src: 'images/2.png', type: 'images'},
	{'name': 'roadD', src: 'images/5.png', type: 'images'},
	{'name': 'roadG1', src: 'images/9.png', type: 'images'},
	{'name': 'roadG', src: 'images/11.png', type: 'images'},
	{'name': 'pai', src: 'images/7.png', type: 'images'}
];
resourceLoader.onProgress = function(e){
	loadScreen.setProgress(e.loadedCount / e.totalCount);
};

resourceLoader.onComplete = function(){
	ScreenObjPool.remove(loadScreen);
	//showWelcome();
	//lineGame();
	//avoidGame();
	background1();
};
var loadScreen = new LoadScreen();

MainApp.init();

MainApp.startRun();

ScreenObjPool.add(loadScreen);

resourceLoader.load(resources);
function showWelcome(){
	var logo = new TextEntityObject('CAR RACE', new Vector(160, 150), {fillStyle: '#900', font: 'bold 64px 微软雅黑', 'textBaseline': 'top'}, 100, 35);

	var welcome = new TextEntityObject('点击开始', new Vector(267, 310), {fillStyle: '#333', font: 'bold 24px 微软雅黑', 'textBaseline': 'top'}, 100, 35);
	MainApp.addEventListener(welcome, 'mouseover', function(e){
		welcome.setStyle({fillStyle: '#999'});
	});

	MainApp.addEventListener(welcome, 'mouseout', function(e){
		welcome.setStyle({fillStyle: '#333'});
	});

	MainApp.addEventListener(welcome, 'click', function(e){
		gameJieshao();

		ScreenObjPool.remove(logo);
		ScreenObjPool.remove(welcome);
		ScreenObjPool.remove(magic);
		ScreenObjPool.remove(magic2);
	});
	var magic = new Magic(new Vector(70, 160), resourceLoader.resources.saint, Magic.ANIM_TYPE.VERTICAL, 56, new Vector(20, 0));
	var magic2 = new Magic(new Vector(70, 260), resourceLoader.resources.soldier, Magic.ANIM_TYPE.VERTICAL, 48, new Vector(20, 0));

	var copy = new TextEntityObject('Power BY: DK', new Vector(390, 230), {fillStyle: '#666', font: 'bold 14px 微软雅黑', 'textBaseline': 'top'}, 100, 20);

	MainApp.addEventListener(copy, 'mouseover', function(e){
		this.setStyle({fillStyle: '#06c'});
	});
	MainApp.addEventListener(copy, 'mouseout', function(e){
		this.setStyle({fillStyle: '#666'});
	});
	MainApp.addEventListener(copy, 'click', function(e){
		window.open('http://www.dklogs.net');
	});
	ScreenObjPool.add(logo);
	ScreenObjPool.add(welcome);
	ScreenObjPool.add(magic);
	ScreenObjPool.add(magic2);
	ScreenObjPool.add(copy);

}
var SCORE = 0;
function startGame(){
	var road = new ImageEntityObject(resourceLoader.get('road'), new Vector(0, 0), 640, 480);
	ScreenObjPool.add(road);

	var images = [];
	images.push(resourceLoader.resources.car1);
	images.push(resourceLoader.resources.car2);
	images.push(resourceLoader.resources.car3);
	images.push(resourceLoader.resources.car4);
	images.push(resourceLoader.resources.car5);
	images.push(resourceLoader.resources.ask);
	// for(var i = 0; i < 3; i++){
	// 	var img =  images[util.random(0, images.length - 1)];
	// 	var temp=util.random(0,4);
	// 	var newCar = new Car(new Vector(temp * 60 + 50, window.util.random(-480, -80)), window.util.randomColor(), img);
	// 	newCar.hitable = true;
	// 	ScreenObjPool.add(newCar);
	// }

	for(var i = 0; i < 11; i++){
		var img =  resourceLoader.resources.coin;
		var newCoin = new Coin(new Vector(i * 24 + 50, window.util.random(-5000, -80)), window.util.randomColor(), img);
		newCoin.coinable = true;
		ScreenObjPool.add(newCoin);
	}
	for(var i = 0; i < 11; i++){
		var img =  resourceLoader.resources.ask;
		var newAsk = new Question(new Vector(i * 24 + 50, window.util.random(-5000, -80)), window.util.randomColor(), img);
		newAsk.question = true;
		ScreenObjPool.add(newAsk);
	}
	// var img =  resourceLoader.resources.coin;
	// var newQ = new Condition(new Vector(3 * 24 + 50, window.util.random(-480, -80)), window.util.randomColor(), img);
	// newQ.condition=true;
	// ScreenObjPool.add(newQ);

	var scorePre = new TextEntityObject('Score: ', new Vector(50, 5), {fillStyle: '#fff', font: 'bold 32px 微软雅黑', 'textBaseline': 'top'}, 100, 35);
	ScreenObjPool.add(scorePre);
	//var score = new TextEntityObject('0', new Vector(160, 5), {fillStyle: '#fff', font: 'bold 32px 微软雅黑', 'textBaseline': 'top'}, 100, 35);
	var score = new GameScore(0, new Vector(160, 5));
	ScreenObjPool.add(score);

	var tree = new Magic(new Vector(370, 0), resourceLoader.get('tree'), Magic.ANIM_TYPE.HORIZONTAL, 50);
	ScreenObjPool.add(tree);

	var bike = new Magic(new Vector(500, 0), resourceLoader.get('bike'), Magic.ANIM_TYPE.HORIZONTAL, 73);
	ScreenObjPool.add(bike);

	var leftC = new CollisionEntityObject(new Vector(0, 0), 30, 480);
	var rightC = new CollisionEntityObject(new Vector(350, 0), 20, 480);
	var topC = new CollisionEntityObject(new Vector(0, 0), 640, 40);
	var bottomC = new CollisionEntityObject(new Vector(0, 480), 640, 10);
	var cMap = new CollistionMap();
	cMap.add(leftC);
	cMap.add(rightC);
	cMap.add(topC);
	cMap.add(bottomC);

	var myCar = new Car(new Vector(240, 390), window.util.randomColor(), resourceLoader.resources.car_p, new Vector(0, 0));
	myCar.setCollisionMap(cMap);
	MainApp.addEventListener(myCar, 'keyup', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(KEY_LOCK.UP){
					this.speed.remove(new Vector(0, -200));
					KEY_LOCK.UP = false;
				}
				break;
			case KEY.DOWN:
				if(KEY_LOCK.DOWN){
					this.speed.remove(new Vector(0, 200));
					KEY_LOCK.DOWN = false;
				}
				break;
			case KEY.LEFT:
				if(KEY_LOCK.LEFT){
					this.speed.remove(new Vector(-200, 0));
					KEY_LOCK.LEFT = false;
				}
				break;
			case KEY.RIGHT:
				if(KEY_LOCK.RIGHT){
					this.speed.remove(new Vector(200, 0));
					KEY_LOCK.RIGHT = false;
				}
				break;
		}
	});

	MainApp.addEventListener(myCar, 'keydown', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(!KEY_LOCK.UP){
					myCar.speed.add(new Vector(0, -200));
					KEY_LOCK.UP = true;
				}
				break;
			case KEY.DOWN:
				if(!KEY_LOCK.DOWN){
					myCar.speed.add(new Vector(0, 200));
					KEY_LOCK.DOWN = true;
				}
				break;
			case KEY.LEFT:
				if(!KEY_LOCK.LEFT){
					myCar.speed.add(new Vector(-200, 0));
					KEY_LOCK.LEFT = true;
				}
				break;
			case KEY.RIGHT:
				if(!KEY_LOCK.RIGHT){
					myCar.speed.add(new Vector(200, 0));
					KEY_LOCK.RIGHT = true;
				}
				break;
		}

	});

	MainApp.addEventListener(myCar, 'hit', function(e){
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		endGame(score.score);
	});
	MainApp.addEventListener(myCar, 'coin', function(e){
		play_coin_music();
        score.addCoin();
		// ScreenObjPool.empty();
		// MainApp.emptyEventsPool();
		// KEY_LOCK = {
		// 	LEFT: false,
		// 	RIGHT: false,
		// 	UP: false,
		// 	DOWN: false
		// }
		// endGame(score.score);
	});
	MainApp.addEventListener(myCar, 'question', function(e){
				game1();
				//MainApp.stopRun();
        //alert("question");
	});
	MainApp.addEventListener(myCar, 'condition', function(e){
        //alert("condition");
	});
	MainApp.addEventListener(myCar, 'deadline', function(e){
        alert("deadline");
	});
	ScreenObjPool.add(myCar);


	if (runWithOther) {
		runWithOther();
	}
}
//最后一个的逻辑，小车排队不能变道
function lineGame(){
	var road = new ImageEntityObject(resourceLoader.get('road'), new Vector(0, 0), 640, 480);
	ScreenObjPool.add(road);
	var img =  resourceLoader.resources.car1;
	var newCar = new Car(new Vector(240, 20), window.util.randomColor(), img, new Vector(0,-20));
	newCar.hitable = true;
	ScreenObjPool.add(newCar);
	var img =  resourceLoader.resources.car2;
	var newCar = new Car(new Vector(240, 120), window.util.randomColor(), img, new Vector(0,-20));
	newCar.hitable = true;
	ScreenObjPool.add(newCar);
	var img =  resourceLoader.resources.car3;
	var newCar = new Car(new Vector(240, 220), window.util.randomColor(), img, new Vector(0,-20));
	newCar.hitable = true;
	ScreenObjPool.add(newCar);
	// var img =  resourceLoader.resources.car4;
	// var newCar = new Car(new Vector(240, 320), window.util.randomColor(), img, new Vector(0,-20));
	// newCar.hitable = true;
	// ScreenObjPool.add(newCar);
	var tree = new Magic(new Vector(370, 0), resourceLoader.get('tree'), Magic.ANIM_TYPE.HORIZONTAL, 50);
	ScreenObjPool.add(tree);
	
	var bike = new Magic(new Vector(500, 0), resourceLoader.get('bike'), Magic.ANIM_TYPE.HORIZONTAL, 73);
	ScreenObjPool.add(bike);
	
	var leftC = new CollisionEntityObject(new Vector(0, 0), 30, 480);
	var rightC = new CollisionEntityObject(new Vector(350, 0), 20, 480);
	var topC = new CollisionEntityObject(new Vector(0, 0), 640, 0);
	var bottomC = new CollisionEntityObject(new Vector(0, 480), 640, 10);
	var cMap = new CollistionMap();
	cMap.add(leftC);
	cMap.add(rightC);
	cMap.add(topC);
	cMap.add(bottomC);
	
	var myCar = new Car(new Vector(240, 390), window.util.randomColor(), resourceLoader.resources.car_p, new Vector(0, 0));
	myCar.setCollisionMap(cMap);
	MainApp.addEventListener(myCar, 'keyup', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(KEY_LOCK.UP){
					this.speed.remove(new Vector(0, -200));
					KEY_LOCK.UP = false;
				}
				break;
			case KEY.DOWN:
				if(KEY_LOCK.DOWN){
					this.speed.remove(new Vector(0, 200));
					KEY_LOCK.DOWN = false;
				}
				break;
			case KEY.LEFT:
				if(KEY_LOCK.LEFT){
					this.speed.remove(new Vector(-200, 0));
					KEY_LOCK.LEFT = false;
				}
				break;
			case KEY.RIGHT:
				if(KEY_LOCK.RIGHT){
					this.speed.remove(new Vector(200, 0));
					KEY_LOCK.RIGHT = false;
				}
				break;
		}
	});
	
	MainApp.addEventListener(myCar, 'keydown', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(!KEY_LOCK.UP){
					myCar.speed.add(new Vector(0, -200));
					KEY_LOCK.UP = true;
				}
				break;
			case KEY.DOWN:
				if(!KEY_LOCK.DOWN){
					myCar.speed.add(new Vector(0, 200));
					KEY_LOCK.DOWN = true;
				}
				break;
			case KEY.LEFT:
				if(!KEY_LOCK.LEFT){
					myCar.speed.add(new Vector(-200, 0));
					KEY_LOCK.LEFT = true;
				}
				break;
			case KEY.RIGHT:
				if(!KEY_LOCK.RIGHT){
					myCar.speed.add(new Vector(200, 0));
					KEY_LOCK.RIGHT = true;
				}
				break;
		}
	});
	MainApp.addEventListener(myCar, 'hit', function(e){
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	myCar.lineable=true;
	MainApp.addEventListener(myCar, 'line', function(e){
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	myCar.end=true;
	MainApp.addEventListener(myCar, 'end', function(e){
		alert("end");
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	myCar.addcar=true;
	MainApp.addEventListener(myCar, 'addcar', function(e){
        myCar.addcar=false;
		var img =  resourceLoader.resources.car5;
		var newCar = new Car(new Vector(240, 460), window.util.randomColor(), img, new Vector(0,-20));
		newCar.hitable = true;
		ScreenObjPool.add(newCar);
	});
	ScreenObjPool.add(myCar);
}
//倒数第二个逻辑，避让行人
function avoidGame(){
	var road = new ImageEntityObject(resourceLoader.get('road'), new Vector(0, 0), 640, 480);
	ScreenObjPool.add(road);
	var img =  resourceLoader.resources.car1;
	var newCar = new Car(new Vector(320, 100), window.util.randomColor(), img, new Vector(-10,20));
	newCar.hitable = true;
	newCar.avoid=true;
	ScreenObjPool.add(newCar);
	var tree = new Magic(new Vector(370, 0), resourceLoader.get('car1'), Magic.ANIM_TYPE.HORIZONTAL, 50);
	ScreenObjPool.add(tree);
	
	var bike = new Magic(new Vector(500, 0), resourceLoader.get('bike'), Magic.ANIM_TYPE.HORIZONTAL, 73);
	ScreenObjPool.add(bike);
	
	var leftC = new CollisionEntityObject(new Vector(0, 0), 30, 480);
	var rightC = new CollisionEntityObject(new Vector(350, 0), 20, 480);
	var topC = new CollisionEntityObject(new Vector(0, 0), 640, 0);
	var bottomC = new CollisionEntityObject(new Vector(0, 480), 640, 10);
	var cMap = new CollistionMap();
	cMap.add(leftC);
	cMap.add(rightC);
	cMap.add(topC);
	cMap.add(bottomC);
	
	var myCar = new Car(new Vector(240, 390), window.util.randomColor(), resourceLoader.resources.car_p, new Vector(0, 0));
	myCar.setCollisionMap(cMap);
	MainApp.addEventListener(myCar, 'keyup', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(KEY_LOCK.UP){
					this.speed.remove(new Vector(0, -200));
					KEY_LOCK.UP = false;
				}
				break;
			case KEY.DOWN:
				if(KEY_LOCK.DOWN){
					this.speed.remove(new Vector(0, 200));
					KEY_LOCK.DOWN = false;
				}
				break;
			case KEY.LEFT:
				if(KEY_LOCK.LEFT){
					this.speed.remove(new Vector(-200, 0));
					KEY_LOCK.LEFT = false;
				}
				break;
			case KEY.RIGHT:
				if(KEY_LOCK.RIGHT){
					this.speed.remove(new Vector(200, 0));
					KEY_LOCK.RIGHT = false;
				}
				break;
		}
	});
	
	MainApp.addEventListener(myCar, 'keydown', function(e){
		var KEY = MainApp.INPUT.KEY;
		switch(e.which){
			case KEY.UP:
				if(!KEY_LOCK.UP){
					myCar.speed.add(new Vector(0, -200));
					KEY_LOCK.UP = true;
				}
				break;
			case KEY.DOWN:
				if(!KEY_LOCK.DOWN){
					myCar.speed.add(new Vector(0, 200));
					KEY_LOCK.DOWN = true;
				}
				break;
			case KEY.LEFT:
				if(!KEY_LOCK.LEFT){
					myCar.speed.add(new Vector(-200, 0));
					KEY_LOCK.LEFT = true;
				}
				break;
			case KEY.RIGHT:
				if(!KEY_LOCK.RIGHT){
					myCar.speed.add(new Vector(200, 0));
					KEY_LOCK.RIGHT = true;
				}
				break;
		}
	});
	MainApp.addEventListener(myCar, 'hit', function(e){
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	MainApp.addEventListener(myCar, 'avoid', function(e){
		alert("avoid");
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	ScreenObjPool.add(myCar);
}
//在高架上时的背景车道，只是要变道逻辑时
function background(){
	var road = new ImageEntityObject(resourceLoader.get('roadG'), new Vector(0, -1920), 640, 480, new Vector(0,100));
	road.miss=true;
	MainApp.addEventListener(road, 'miss', function(e){
		alert("miss");
		ScreenObjPool.empty();
		MainApp.emptyEventsPool();
		KEY_LOCK = {
			LEFT: false,
			RIGHT: false,
			UP: false,
			DOWN: false
		}
		//endGame(score.score);
	});
	ScreenObjPool.add(road);
	console.log(road.position);
	// var img =  resourceLoader.resources.pai;
	// var lupai = new Car(new Vector(523, 0), window.util.randomColor(), img, new Vector(0,100));
	//ScreenObjPool.add(lupai);
}
//在高架上随便开车时的背景
function background1(){
	var road = new ImageEntityObject(resourceLoader.get('roadG1'), new Vector(0, -480), 640, 480, new Vector(0,100));
	ScreenObjPool.add(road);
}



function stop_coin_music(){
	$('#coin_play audio').get(0).pause();
}

function play_coin_music(){
	$('#coin_play audio').get(0).load();
	$('#coin_play audio').get(0).play();
	var t=setTimeout("stop_coin_music()",5000);
}

function stopGame() {
	//var stop=new ;
	MainApp.stopRun();
}
function endGame(score){

	var end = new TextEntityObject('GAME OVER', new Vector(120, 150), {fillStyle: '#900', font: 'bold 64px 微软雅黑', 'textBaseline': 'top'}, 100, 35);

	ScreenObjPool.add(end);

	var score = new TextEntityObject('Score: ' + ~~score, new Vector(240,240), {fillStyle: '#000', font: 'bold 32px 微软雅黑', 'textBaseline': 'top'}, 100, 35);
	ScreenObjPool.add(score);

	var restart = new TextEntityObject('重新开始', new Vector(267, 310), {fillStyle: '#333', font: 'bold 24px 微软雅黑', 'textBaseline': 'top'}, 100, 35);
	MainApp.addEventListener(restart, 'mouseover', function(e){
		restart.setStyle({fillStyle: '#999'});
	});


	MainApp.addEventListener(restart, 'mouseout', function(e){
		restart.setStyle({fillStyle: '#333'});
	});

	ScreenObjPool.add(restart);

	MainApp.addEventListener(restart, 'click', function(e){
		ScreenObjPool.remove(end);
		ScreenObjPool.remove(restart);

		startGame();
	});

}


var KEY_LOCK = {
	LEFT: false,
	RIGHT: false,
	UP: false,
	DOWN: false
}

</script>
<script type="text/javascript">
function play_music(){
    if ($('#mc_play').hasClass('on')){
        $('#mc_play audio').get(0).pause();
        $('#mc_play').attr('class','stop');
    }else{
        $('#mc_play audio').get(0).play();
        $('#mc_play').attr('class','on');
    }
    event.stopPropagation(); //阻止冒泡
}
function just_play(id){
    $('#mc_play audio').get(0).play();
    $('#mc_play').attr('class','on');
    event.stopPropagation(); //阻止冒泡
}
    function is_weixn(){
        return false;
        var ua = navigator.userAgent.toLowerCase();
        if(ua.match(/MicroMessenger/i)=="micromessenger") {
            return true;
        } else {
            return false;
        }
    }
    window.onload=function(){
        if (!is_weixn()){
            just_play();
        }
    }
</script>
<script src="gameCtrl.js"></script>
</body>
</html>
